function Arrow(A){this.cps=A}function ProgressArrow(){if(!(this instanceof ProgressArrow)){return new ProgressArrow()}this.cancellers=[];this.observers=[]}ProgressArrow.prototype=new Arrow(function(C,B,A){this.observers.push(function(D){A(D,B)})});Object.extend(Arrow.prototype,{Arrow:function(){return this},next:function(A){var B=this;A=A.Arrow();return new Arrow(function(E,D,C){B.cps(E,D,function(G,F){A.cps(G,F,C)})})},run:function(B,A){A=A||new ProgressArrow();this.cps(B,A,function(){});return A}});Object.extend(Function.prototype,{Arrow:function(){var A=this;return new Arrow(function(D,C,B){B(A(D),C)})},A:function(){return this},next:function(A){var B=this;A=A.A();return function(C){return A(B(C))}}});Object.extend(ProgressArrow.prototype,{addCanceller:function(A){this.cancellers.push(A)},advance:function(B){var A=this.cancellers.indexOf(B);if(A>=0){this.cancellers.splice(A,1)}while(this.observers.length>0){this.observers.pop()()}},cancel:function(){while(this.cancellers.length>0){this.cancellers.pop()()}}});