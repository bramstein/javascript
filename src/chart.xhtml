<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/xhtml; charset=utf-8" />
		<script type="text/javascript" src="core/object.js"></script>
		<script type="text/javascript" src="core/array.js"></script>
		<script type="text/javascript" src="core/function.js"></script>
		<script type="text/javascript" src="core/fun.js"></script>
		<script type="text/javascript" src="core/math.js"></script>
		<script type="text/javascript" src="chart/chart.js"></script>
		<script type="text/javascript">
		<![CDATA[
			var ctx = null;

			var m = Math.Interval(10,10);

			function f(x, y) {
				return x.equals(y);
			}

			function test(data, x, y, w, h, depth) {
			//	if (depth >= 50) {
			//		return;
			//	}

				depth += 1;

				if (x.length() <= 1 || y.length() <= 1) {
					var rx = Math.round((x.from + x.to) / 2);
					var ry = Math.round((y.from + y.to) / 2);	
					var i = (ry * w + rx) * 4;
					data[i] = 255;
					data[i + 1] = 0;
					data[i + 2] = 0;
					data[i + 3] = 255;
				}
				else if (f(x, y)) {
					var x1 = Math.Interval(x.from, (x.from + x.to) / 2);
					var x2 = Math.Interval((x.from + x.to) / 2, x.to);
					var y1 = Math.Interval(y.from, (y.from + y.to) / 2);
					var y2 = Math.Interval((y.from + y.to) /2, y.to);

					if (f(x1, y1)) {
						test(data, x1, y1, w, h, depth);
					}
					if (f(x1, y2)) {
						test(data, x1, y2, w, h, depth);
					}
					if (f(x2, y1)) {
						test(data, x2, y1, w, h, depth);
					}
					if (f(x2, y2)) {
						test(data, x2, y2, w, h, depth);
					}
				}
	
			}

			function draw() {

				var canvas = document.getElementById('canvas-context');

				if (canvas.getContext)
				{
					ctx = canvas.getContext('2d');

					var image = ctx.getImageData(0, 0, canvas.width, canvas.height);

					var w = image.width, h = image.height;
					var data = image.data;

					test(data, Math.Interval(0, canvas.width), Math.Interval(0, canvas.height), w, h, 0);
	/*

					for (var y = 0; y < h; y += 1) {
       					for (var x = 0; x < w; x += 1) {
							for (var c = 0; c < 3; c += 1) {
								var i = (y*w + x)*4 + c;
								//data[i] = Math.random() * 255;
								if (f(Math.Interval(x, x), Math.Interval(y, y))) {
									if (c === 0) {
										data[i] = 255;
									}
									else {
										data[i] = 0;
									}
								}
								else {
									data[i] = 255;
								}
							}
							data[(y*w + x)*4 + 3] = 255;
						}
					}
*/
					ctx.putImageData(image, 0, 0);

					//ctx.translate(20.5,-20.5);

					//ctx.save();
					//var a = chart.axis({base: 0, length: 280});
					//var b = chart.axis({base: 0, length: 160, orientation: 'vertical'});
					//chart.draw(a, ctx);
					//chart.draw(b, ctx);
					//ctx.restore();
				}


			}
		]]>
		</script>
		<style>
			#canvas-context {
				border: 1px solid black;
			}
		</style>
	</head>
	<body onload="draw();">
		<canvas id="canvas-context" width="100" height="100"></canvas>
	</body>
</html>
